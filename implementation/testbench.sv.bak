// ?  try to add include here 
import ref_model_pkg::*;
import elec_layer_tr_pkg::*;
import upper_layer_tr_pkg::*;
import config_space_pkg::*;

module testbench ();
    
parameter clk_cycle = 10 ;

    /*// clock genrator 
    initial begin
    clk = 0 ;

    forever begin
        #(clk_cycle/2) clk = ~clk;
    end
end*/

int i ;

// create the objects
config_transaction      C_transaction ;
config_transaction      C_transaction ;
elec_layer_tr               E_transaction ;
elec_layer_tr               E_transaction;
upper_layer_tr                    T_transaction ;
ref_model                           ref_model_inst ;


// create the mailboxes
mailbox  #(elec_layer_tr) elec_ag ;
mailbox  #(upper_layer_tr) trans_ag_Tx ;
mailbox  #(upper_layer_tr) trans_ag_Rx ;
mailbox  #(elec_layer_tr) elec_ag ;
mailbox  #(config_transaction)  config_ag ;
mailbox  #(config_transaction)  config_ag ;


// create rondom variables 
initial begin

    $dumpfile("testbench.vcd");
    $dumpvars(0,testbench);

    elec_ag    = new();
    trans_ag_Rx  = new();
    elec_ag   = new();  
    elec_ag    = new();
     config_ag = new();
     config_ag = new();

    ref_model_inst = new( config_ag ,  config_ag , elec_ag , elec_ag , trans_ag_Rx,trans_ag_Tx );

    C_transaction = new();
    C_transaction = new();
    E_transaction = new();
    E_transaction = new();
    T_transaction      = new();


    $display("Start of Test");
   for ( i=0 ;i<10 ; i++) 
 begin   

     $display("\n \n _____________ start putting from ref_model_inst -------------- \n \n ");
            // randomize the transaction
            assert (C_transaction .randomize())  ;
            assert (E_transaction .randomize())  ;
            assert (T_transaction .randomize())  ;
            E_transaction.phase = i%5 +1;        // to make sure that the phase is [1->5]
            $display("C_transaction = %p",C_transaction);
            $display("E_transaction = %p",E_transaction);
            $display("T_transaction = %p",T_transaction);


            // ------------------------send the transaction to the reference model
            if (E_transaction.phase == 1) begin
                elec_ag.put(E_transaction);
                 config_ag.put(C_transaction);
                #clk_cycle;
            end
            else if (E_transaction.phase == 2) begin
                elec_ag.put(E_transaction);
                #clk_cycle;
            end
            else if (E_transaction.phase == 3) begin
                elec_ag.put(E_transaction);
                 config_ag.put(C_transaction);
                #clk_cycle;
            end
            else if (E_transaction.phase == 4) begin  
                elec_ag.put(E_transaction);
                 config_ag.put(C_transaction);
                #clk_cycle;
            end
            else if (E_transaction.phase == 5) begin  
                elec_ag.put(E_transaction);
                trans_ag_Rx.put(T_transaction);
                #clk_cycle;
            end
            ref_model_inst.run_phase();
            #clk_cycle;

            
            
            
            
            
            $display(" _______________start gettng from ref_model_inst-------------- ");
            // ------------------------get the transaction from the reference model
            if (E_transaction.phase == 1) begin
                elec_ag.get(E_transaction);
                $display("E_transaction = %p",E_transaction);         // get value of  sptx = 0 . before phase 1
                //elec_ag.get(E_transaction);
                 config_ag.get(C_transaction);
                $display("C_transaction = %p",C_transaction);
                //$display("E_transaction = %p",E_transaction);         // get value of  sptx in phase 1 
                
            end

            else if (E_transaction.phase == 2) begin
                elec_ag.get(E_transaction);
                $display("E_transaction = %p",E_transaction);  
            end

            else if (E_transaction.phase == 3) begin
                elec_ag.get(E_transaction);  
                $display("E_transaction = %p",E_transaction);  
            end

            else if (E_transaction.phase == 4) begin
                elec_ag.get(E_transaction);
                $display("E_transaction = %p",E_transaction);  
            end

            else if (E_transaction.phase == 5) begin
                elec_ag.get(E_transaction);
                $display("E_transaction = %p",E_transaction);  
                trans_ag_Tx.get(T_transaction);
                $display("T_transaction = %p",T_transaction);
            end

            
           /* trans_ag.get(T_transaction);
            $display("Done getting from trans_ag");
            $display("T_transaction = %p",T_transaction);*/
            #clk_cycle;

            $display(" \n \n//////////////////////////////////////");
            $display("//////////////////////////////////////");
            $display("//////////////////////////////////////");
            $display("  ⁂⁂⁂⁂⁂⁂ ------ rep %0d done ---- ⁂⁂⁂⁂⁂⁂  ",i+1) ;
            $display("//////////////////////////////////////");
            $display("//////////////////////////////////////\n \n");
            
    end

    #(50*clk_cycle);
    $stop;


end

endmodule